\chapter{MkTreap}
\label{ch:treap-bst}
\begin{preamble}
Implements the \sml{BST} signature with treaps. Keys are hashed in order to
generate pseudo-random priorities.
\begin{verbatim}
functor MkTreap (structure Key : HASHKEY) :> BST where Key = Key
\end{verbatim}
\end{preamble}

\section{Cost Specification}

\begin{gram}
The following costs assume that the work and span of \sml{Key.compare}
and \sml{Key.hash} are constant.
\end{gram}

\begin{costspec}[Constant-Work Operations]
\begin{tabular}{c|c|c}
& \textbf{Work} & \textbf{Span} \\
$\sml{expose}~T$ & $\bigO 1$ & $\bigO 1$ \\
$\sml{size}~T$ & $\bigO 1$ & $\bigO 1$ \\
$\sml{empty}~()$ & $\bigO 1$ & $\bigO 1$ \\
$\sml{singleton}~(k,v)$ & $\bigO 1$ & $\bigO 1$
\end{tabular}
\end{costspec}

\begin{costspec}[Join]
\label{cost:treap:join}
\begin{tabular}{c|c|c}
& \textbf{Work} & \textbf{Span} \\
$\sml{join}~(A,B)$ & $\bigO {\log\left(|A| + |B|\right)}$ & $\bigO {\log\left(|A| + |B|\right)}$ \\
$\sml{joinMid}~(A,(k,v),B)$ & $\bigO {\log\left(|A| + |B|\right)}$ & $\bigO {\log\left(|A| + |B|\right)}$
\end{tabular}
\end{costspec}

\begin{costspec}[Split]
\label{cost:treap:split}
\begin{tabular}{c|c|c}
& \textbf{Work} & \textbf{Span} \\
$\sml{split}~(T,k)$ & $\bigO {\log|T|}$ & $\bigO {\log|T|}$
\end{tabular}
\end{costspec}

\begin{note}
The costs of \ref{cost:treap:join} and \ref{cost:treap:split} are with
high probability.
\end{note}

